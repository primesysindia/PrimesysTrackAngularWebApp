<div class="content-section">
  <div class="row">
    <mat-card-header class="col-md-12 header-title"> 
      <mat-card-title>ISSUE REGISTER</mat-card-title>
    </mat-card-header>
  </div>
  
  <!-- <h1><mat-card-title >ADD ISSUE </mat-card-title></h1> -->
  <mat-card class="example-card">
    <mat-card-content style="background:ghostwhite">
      <form class="example-form" [formGroup]="addIssueForm">
        <mat-card class="example-card">
          <mat-card-content style="background: ghostwhite; ">
          <div class="row">    
            <div class="col-md-12 float-right">
              <a [routerLink]="['/issue-history']" mat-raised-button style="background: #09a0a0; color: white;" class="float-right">
                Issue History
              </a>
            </div>
            <mat-form-field class="example-full-width col-md-6 col-sm-6">
              <mat-select placeholder="Select Device" #singleSelect>
                <mat-option class="searchable">
                  <app-mat-select-search [formControl]="deviceFilterCtrl"></app-mat-select-search>
                </mat-option>
                <mat-option *ngFor="let devices of filteredDevices | async" value={{devices.student_id}}>
                  <div (click)="onSelection($event, devices)">
                    {{devices.name}}
                  </div>
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field class="col-md-6 col-sm-6">
              <mat-label>Select Issue</mat-label>
              <mat-select formControlName="issue">
                <mat-option *ngFor="let option of issue" [value]="option.isseMasterId">
                  <!-- <div (click)="optionClicked($event, option)"> -->
                  {{option.issueTitle}}
                  <!-- </div>   -->
                </mat-option>
              </mat-select>
              <mat-error>This field is required.</mat-error>
            </mat-form-field>
          </div>

          <!-- <mat-accordion *ngIf="showAccordion">
            <mat-expansion-panel hideToggle>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  This is the expansion title
                </mat-panel-title>
              </mat-expansion-panel-header>
              <mat-radio-group aria-label="Select an option">
                <mat-radio-button value="1">Option 1</mat-radio-button>
                <mat-radio-button value="2">Option 2</mat-radio-button>
              </mat-radio-group>
            </mat-expansion-panel>
            <mat-expansion-panel (opened)="panelOpenState = true"
                                 (closed)="panelOpenState = false">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Self aware panel
                </mat-panel-title>
                <mat-panel-description>
                  Currently I am {{panelOpenState ? 'open' : 'closed'}}
                </mat-panel-description>
              </mat-expansion-panel-header>
              <p>I'm visible because I am open</p>
            </mat-expansion-panel>
          </mat-accordion> -->

          <div class="col-md-6 table-responsive" *ngIf="showTable">
            <table class="table table-bordered">
              <tr>
                <th>Questions</th>
                <th>Yes</th>
                <th>No</th>
              </tr>
              <tr>
                <td>Device Not Show On</td>
                <td>
                <!-- <mat-radio-group>
                  <mat-radio-button value="1">Yes</mat-radio-button>
                </mat-radio-group> -->
                <mat-checkbox class="example-margin">Yes</mat-checkbox>
                </td>
                <td>
                <!-- <mat-radio-group>
                  <mat-radio-button value="0" (click)="onItemChange($event)">No</mat-radio-button>
                </mat-radio-group> -->
                <mat-checkbox class="example-margin" (click)="onItemChange($event)">No</mat-checkbox>
              </td>
              </tr>
            </table>
            
          </div>
          <p>{{this.message}}</p>
          <div class="row">
            <mat-form-field class="col-md-6">
              <mat-label>Name</mat-label>
                <input type="text" matInput placeholder="Enter Your Name" name="caller_name" formControlName="caller_name">
              <mat-error>This field is required.</mat-error>
            </mat-form-field>
            <mat-form-field class="col-md-6">
              <mat-label>Contact Number</mat-label>
              <input type="number" matInput placeholder="Your Contact Number" name="contact" formControlName="contact">
              <mat-error>This field is required.</mat-error>
            </mat-form-field>
          </div>
          <div class="row">
            <mat-form-field class="col-md-12">
              <mat-label>Remarks</mat-label>
              <textarea matInput placeholder="Enter Remarks" name="description" formControlName="description"></textarea>
              <mat-error>This field is required.</mat-error>
            </mat-form-field>
          </div>
        
          <mat-accordion style="background: ghostwhite;" *ngIf="showDevDetails">
            <mat-expansion-panel [expanded]="true" style="background: ghostwhite;" (opened)="panelOpenState = true"
                         (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <h6>Device Details</h6>
              </mat-panel-title>
            </mat-expansion-panel-header>
              <!-- <p>I'm visible because I am open</p> -->
              <div class="row" >
                <div class="col-md-6">
                  <div class="row" style="margin-bottom: 3px;">
                    <div class="col-md-12">
                      <strong>IMEI No: </strong>{{imeiNo}}
                    </div>
                  </div>
                  <div class="row" style="margin-bottom: 3px;">
                    <div class="col-md-12">
                      <strong>SIM No: </strong>{{simNo}}
                    </div>
                  </div>
    
                  <div class="row" style="margin-bottom: 3px;">
                    <div class="col-md-12" >
                      <strong>Battery Status: </strong><span *ngIf="data.deviceBatteryTime > 0; else showZero">{{data.deviceBattery}}  {{data.deviceBatteryTime*1000 |  date : "MMM d, y  HH:mm"}}</span>
                    </div>
                  </div>
                  <ng-template #showZero>
                    {{data.deviceBattery}} {{data.deviceBatteryTime}}
                  </ng-template>
                  
                  <div class="row" style="margin-bottom: 3px;">
                    <div class="col-md-12">
                      <strong>Network Strength: </strong>{{data.deviceRange}}
                    </div>
                  </div>
                  <div class="row" style="margin-bottom: 3px;">
                    <div class="col-md-12" >
                      <strong>Location Time:</strong><span *ngIf="data.locationTime > 0; else showZeroLocation"> {{data.locationTime*1000  |  date : "MMM d, y HH:mm"}}</span>
                    </div>
                      <ng-template #showZeroLocation>
                        {{data.locationTime}}
                      </ng-template>
                  </div>
                  <div class="row" style="margin-bottom: 3px;">
                    <div class="col-md-12">
                      <strong>Service Expiry: </strong> {{data.ExpiryDate}} <span *ngIf="data.PaymentStatus == 'Active'; else inactive;" style="color: green">({{data.PaymentStatus}})</span>
                      <ng-template #inactive>
                      <span style="color: red">({{data.PaymentStatus}})</span>
                      </ng-template>
                    </div>
                  </div>
                </div>
                  <!-- <div class="row" style="margin-bottom: 3px;"> -->
                    <div class="col-md-6 table-responsive">
                      <h6>Beat Information:</h6>
                      <table class="table table-bordered">
                        <tr>
                          <th>Section</th>
                          <th>Start Beat</th>
                          <th>End Beat</th>
                        </tr>
                        <tr *ngFor="let beatList of beatInfo">
                          <td>{{beatList.sectionName}}</td>
                          <td>{{beatList.kmStart}}</td>
                          <td>{{beatList.kmEnd}}</td>
                        </tr>
                      </table>
                      
                    </div>
                  <!-- </div> -->
                
              </div>
            </mat-expansion-panel>
          </mat-accordion>
          </mat-card-content> 
        </mat-card>
      <mat-card>
        <mat-card-content style="background: ghostwhite; ">

        <div class="row">
          <div class="col-md-6">
            <button style="background-color: #205c69; color: white" class="btn" (click)="saveIssue()" mat-button mat-raised-button  class="list-group-item list-group-item-action">SAVE</button> 
          </div>
          <div class="col-md-6">
            <button style="background-color: #E80000; color: white" mat-button mat-raised-button (click)="reset()"  class="list-group-item list-group-item-action">CANCEL</button>
          </div>
        </div>
        </mat-card-content>
      </mat-card>
      </form>
    </mat-card-content>
  </mat-card>
    <ngx-loading [show]="loading" [config]="{ animationType: ngxLoadingAnimationTypes.wanderingCubes, backdropBorderRadius: '3px'}" ></ngx-loading>
</div>
















